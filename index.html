<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة FYO التعليمية | تسجيل الدخول</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'El Messiri', 'Tajawal', sans-serif;
        }

        :root {
            --primary-color: #6C63FF;
            --secondary-color: #4A90E2;
            --accent-color: #36D1DC;
            --light-color: #F8F9FF;
            --success-color: #77D970;
            --warning-color: #FF9A76;
            --danger-color: #FF6584;
            --text-dark: #2D3748;
            --text-light: #718096;
        }

        body {
            background: linear-gradient(135deg, #F8F9FF 0%, #E6F7FF 50%, #F0F4FF 100%);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.15;
            animation: floatShape 20s infinite linear;
        }

        .shape-1 {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            top: -150px;
            right: -150px;
            animation-delay: 0s;
        }

        .shape-2 {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            bottom: -100px;
            left: -100px;
            animation-delay: 5s;
        }

        .shape-3 {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            top: 50%;
            left: 10%;
            animation-delay: 10s;
        }

        .shape-4 {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            bottom: 20%;
            right: 15%;
            animation-delay: 15s;
        }

        @keyframes floatShape {
            0% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(90deg); }
            50% { transform: translateY(-40px) rotate(180deg); }
            75% { transform: translateY(-20px) rotate(270deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }

        .container {
            width: 100%;
            max-width: 480px;
            z-index: 1;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 15px;
            box-shadow: 0 10px 30px rgba(108, 99, 255, 0.3);
            transform: rotate(45deg);
        }

        .logo-icon i {
            font-size: 2.5rem;
            color: white;
            transform: rotate(-45deg);
        }

        .logo-text {
            font-size: 3.2rem;
            font-weight: 800;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
            text-shadow: 0 5px 15px rgba(108, 99, 255, 0.1);
        }

        .subtitle {
            font-size: 1.3rem;
            color: var(--secondary-color);
            font-weight: 500;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 50px 40px;
            box-shadow: 0 20px 60px rgba(108, 99, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
        }

        .login-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 70px rgba(108, 99, 255, 0.2);
        }

        .login-title {
            text-align: center;
            font-size: 1.9rem;
            margin-bottom: 40px;
            font-weight: 700;
            color: var(--text-dark);
            position: relative;
            padding-bottom: 20px;
        }

        .login-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 50%;
            transform: translateX(50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 30px;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1rem;
            padding-right: 5px;
        }

        .input-with-icon {
            position: relative;
        }

        .form-input {
            width: 100%;
            padding: 18px 50px 18px 25px;
            background: rgba(248, 249, 255, 0.8);
            border: 2px solid rgba(108, 99, 255, 0.1);
            border-radius: 15px;
            color: var(--text-dark);
            font-size: 1.05rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.1);
            background: white;
        }

        .input-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .login-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(to right, var(--accent-color), var(--primary-color));
            transition: width 0.4s ease;
            z-index: -1;
        }

        .login-btn:hover::before {
            width: 100%;
        }

        .login-btn:hover {
            box-shadow: 0 10px 25px rgba(108, 99, 255, 0.3);
            transform: translateY(-3px);
        }

        .admin-info {
            text-align: center;
            margin-top: 30px;
            font-size: 0.9rem;
            color: var(--text-light);
            padding: 20px;
            background: rgba(108, 99, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(108, 99, 255, 0.1);
        }

        .admin-info p {
            margin-bottom: 8px;
        }

        .copyright {
            text-align: center;
            margin-top: 50px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* نمط لوحة المسؤول */
        .admin-panel {
            display: none;
            width: 100%;
            max-width: 1400px;
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 25px 70px rgba(108, 99, 255, 0.15);
            border: 1px solid rgba(108, 99, 255, 0.1);
            z-index: 1;
            position: relative;
            margin: 0 auto;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 2px solid rgba(108, 99, 255, 0.1);
        }

        .admin-header h1 {
            font-size: 2rem;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
        }

        .admin-header h1 i {
            margin-left: 15px;
        }

        .logout-btn {
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            box-shadow: 0 5px 15px rgba(108, 99, 255, 0.2);
        }

        .logout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(108, 99, 255, 0.3);
        }

        .logout-btn i {
            margin-left: 10px;
        }

        .admin-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            background: rgba(108, 99, 255, 0.05);
            padding: 15px;
            border-radius: 18px;
        }

        .nav-btn {
            background: white;
            border: 2px solid rgba(108, 99, 255, 0.1);
            color: var(--text-dark);
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);
        }

        .nav-btn i {
            margin-left: 10px;
            font-size: 1.1rem;
        }

        .nav-btn.active {
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            color: white;
            border-color: transparent;
            box-shadow: 0 5px 20px rgba(108, 99, 255, 0.3);
        }

        .nav-btn:hover:not(.active) {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(108, 99, 255, 0.1);
        }

        .admin-section {
            display: none;
            background: rgba(248, 249, 255, 0.7);
            border-radius: 20px;
            padding: 30px;
            margin-top: 20px;
            border: 1px solid rgba(108, 99, 255, 0.1);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .admin-section.active {
            display: block;
        }

        .section-title {
            font-size: 1.7rem;
            margin-bottom: 30px;
            color: var(--text-dark);
            border-right: 5px solid var(--primary-color);
            padding-right: 20px;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-left: 15px;
            color: var(--primary-color);
        }

        .users-table, .files-table, .tests-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 25px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }

        .users-table th, .files-table th, .tests-table th {
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            color: white;
            padding: 20px;
            text-align: right;
            font-weight: 600;
            border: none;
        }

        .users-table td, .files-table td, .tests-table td {
            padding: 20px;
            background: white;
            border-bottom: 1px solid rgba(108, 99, 255, 0.1);
            font-weight: 500;
        }

        .users-table tr:last-child td {
            border-bottom: none;
        }

        .users-table tr:hover td {
            background: rgba(108, 99, 255, 0.03);
        }

        .action-btn {
            background: white;
            border: 2px solid rgba(108, 99, 255, 0.2);
            color: var(--text-dark);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
        }

        .action-btn i {
            margin-left: 8px;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background: linear-gradient(to right, var(--danger-color), #FF8E9E);
            color: white;
            border-color: transparent;
        }

        .btn-danger:hover {
            background: linear-gradient(to right, #FF8E9E, var(--danger-color));
        }

        .btn-success {
            background: linear-gradient(to right, var(--success-color), #95E28F);
            color: white;
            border-color: transparent;
        }

        .btn-success:hover {
            background: linear-gradient(to right, #95E28F, var(--success-color));
        }

        .btn-warning {
            background: linear-gradient(to right, var(--warning-color), #FFB896);
            color: white;
            border-color: transparent;
        }

        .btn-warning:hover {
            background: linear-gradient(to right, #FFB896, var(--warning-color));
        }

        .form-row {
            display: flex;
            gap: 25px;
            margin-bottom: 25px;
        }

        .form-group-half {
            flex: 1;
        }

        .form-actions {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }

        .welcome-message {
            background: linear-gradient(to right, rgba(108, 99, 255, 0.1), rgba(54, 209, 220, 0.1));
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 40px;
            border: 1px solid rgba(108, 99, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .welcome-message::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
        }

        .welcome-title {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--text-dark);
        }

        .welcome-text {
            color: var(--text-light);
            line-height: 1.8;
            font-size: 1.1rem;
        }

        /* بطاقات الإحصائيات */
        .stats-cards {
            display: flex;
            gap: 25px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .stat-card {
            flex: 1;
            min-width: 200px;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(108, 99, 255, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(108, 99, 255, 0.1);
        }

        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 20px;
            font-size: 1.8rem;
            color: white;
        }

        .stat-icon.users {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .stat-icon.files {
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        }

        .stat-icon.tests {
            background: linear-gradient(135deg, var(--warning-color), var(--danger-color));
        }

        .stat-icon.streak {
            background: linear-gradient(135deg, var(--success-color), var(--accent-color));
        }

        .stat-number {
            font-size: 2.8rem;
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--text-light);
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* تصميم للهواتف */
        @media (max-width: 768px) {
            .admin-panel {
                padding: 25px;
            }
            
            .admin-nav {
                flex-direction: column;
            }
            
            .form-row {
                flex-direction: column;
                gap: 20px;
            }
            
            .stats-cards {
                flex-direction: column;
            }
            
            .users-table, .files-table, .tests-table {
                font-size: 0.9rem;
            }
            
            .users-table td, .files-table td, .tests-table td {
                padding: 15px 10px;
            }
            
            .action-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
                margin-left: 5px;
            }
            
            .login-card {
                padding: 40px 25px;
            }
        }

        /* تصميم لشاشات كبيرة */
        @media (min-width: 1400px) {
            .container {
                max-width: 550px;
            }
            
            .admin-panel {
                max-width: 1500px;
            }
        }

        /* تأثيرات إضافية */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(108, 99, 255, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(108, 99, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(108, 99, 255, 0); }
        }

        /* تحسينات للألوان المريحة */
        .badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .badge-success {
            background: rgba(119, 217, 112, 0.15);
            color: var(--success-color);
        }
        
        .badge-warning {
            background: rgba(255, 154, 118, 0.15);
            color: var(--warning-color);
        }
        
        .badge-danger {
            background: rgba(255, 101, 132, 0.15);
            color: var(--danger-color);
        }
        
        .badge-info {
            background: rgba(108, 99, 255, 0.15);
            color: var(--primary-color);
        }
        
        .badge-streak {
            background: linear-gradient(135deg, rgba(255, 154, 118, 0.15), rgba(119, 217, 112, 0.15));
            color: var(--warning-color);
            font-weight: 700;
        }
    </style>
</head>
<body>
    <!-- أشكال عائمة في الخلفية -->
    <div class="floating-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
        <div class="shape shape-4"></div>
    </div>
    
    <!-- واجهة تسجيل الدخول -->
    <div class="container" id="loginContainer">
        <div class="header">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="logo-text">F Y O</div>
            </div>
            <div class="subtitle">منصة القدرات التعليمية الفاخرة</div>
        </div>
        
        <div class="login-card">
            <h2 class="login-title">تسجيل الدخول للمسؤول</h2>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">اسم المستخدم</label>
                    <div class="input-with-icon">
                        <input type="text" class="form-input" id="username" placeholder="أدخل اسم المستخدم" required>
                        <div class="input-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">كلمة المرور</label>
                    <div class="input-with-icon">
                        <input type="password" class="form-input" id="password" placeholder="أدخل كلمة المرور" required>
                        <div class="input-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="login-btn pulse">
                    <i class="fas fa-sign-in-alt"></i> دخول لوحة التحكم
                </button>
            </form>
            
            <div class="admin-info">
                <p><i class="fas fa-info-circle"></i> هذه الواجهة للمسؤول فقط</p>
                <p><strong>اسم المستخدم:</strong> admin | <strong>كلمة المرور:</strong> admin</p>
                <p style="margin-top: 10px; font-size: 0.85rem; color: var(--warning-color);">
                    <i class="fas fa-exclamation-triangle"></i> الطلاب لا يمكنهم إنشاء حسابات، بل يتم إنشاؤها من قبل المسؤول فقط
                </p>
            </div>
        </div>
        
        <div class="copyright">
            © 2023 منصة FYO التعليمية. تصميم فاخر بألوان مريحة للنفس
        </div>
    </div>
    
    <!-- لوحة تحكم المسؤول -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <h1><i class="fas fa-crown"></i> لوحة تحكم منصة FYO - المسؤول</h1>
            <button class="logout-btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</button>
        </div>
        
        <!-- رسالة ترحيبية -->
        <div class="welcome-message">
            <h2 class="welcome-title">مرحباً بك في لوحة التحكم الفاخرة</h2>
            <p class="welcome-text">أنت الآن في لوحة التحكم الخاصة بمنصة FYO التعليمية. من هنا يمكنك إدارة جميع المستخدمين (الطلاب)، رفع الملفات التعليمية، إنشاء الاختبارات الإلكترونية، ومتابعة إحصائيات الطلاب. الطلاب لا يملكون صلاحياتك ويمكنهم فقط الوصول للمحتوى المخصص لهم.</p>
        </div>
        
        <!-- بطاقات الإحصائيات -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-icon users">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-number" id="totalUsers">5</div>
                <div class="stat-label">إجمالي الطلاب</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon files">
                    <i class="fas fa-file-upload"></i>
                </div>
                <div class="stat-number" id="totalFiles">3</div>
                <div class="stat-label">ملف مرفوع</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon tests">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="stat-number" id="totalTests">2</div>
                <div class="stat-label">اختبار منشور</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon streak">
                    <i class="fas fa-fire"></i>
                </div>
                <div class="stat-number" id="avgStreak">4.2</div>
                <div class="stat-label">متوسط الستريك</div>
            </div>
        </div>
        
        <!-- شريط التنقل -->
        <div class="admin-nav">
            <button class="nav-btn active" data-section="users-section"><i class="fas fa-user-graduate"></i> إدارة الطلاب</button>
            <button class="nav-btn" data-section="files-section"><i class="fas fa-cloud-upload-alt"></i> رفع الملفات</button>
            <button class="nav-btn" data-section="tests-section"><i class="fas fa-edit"></i> إدارة الاختبارات</button>
            <button class="nav-btn" data-section="stats-section"><i class="fas fa-chart-pie"></i> إحصائيات متقدمة</button>
        </div>
        
        <!-- قسم إدارة الطلاب -->
        <div class="admin-section active" id="users-section">
            <h2 class="section-title"><i class="fas fa-user-plus"></i> إضافة طالب جديد</h2>
            
            <form id="addUserForm">
                <div class="form-row">
                    <div class="form-group-half">
                        <label class="form-label">اسم الطالب</label>
                        <input type="text" class="form-input" id="newUsername" placeholder="اسم الطالب الجديد" required>
                    </div>
                    <div class="form-group-half">
                        <label class="form-label">كلمة المرور</label>
                        <input type="password" class="form-input" id="newPassword" placeholder="كلمة المرور للطالب" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group-half">
                        <label class="form-label">البريد الإلكتروني</label>
                        <input type="email" class="form-input" id="newEmail" placeholder="البريد الإلكتروني (اختياري)">
                    </div>
                    <div class="form-group-half">
                        <label class="form-label">مدة الاشتراك (أيام)</label>
                        <input type="number" class="form-input" id="subscriptionDays" placeholder="عدد أيام الاشتراك" min="1" value="30" required>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="action-btn btn-success"><i class="fas fa-user-plus"></i> إضافة طالب جديد</button>
                    <button type="button" class="action-btn btn-warning" id="renewAllBtn"><i class="fas fa-sync-alt"></i> تجديد جميع الاشتراكات</button>
                </div>
            </form>
            
            <h2 class="section-title" style="margin-top: 40px;"><i class="fas fa-list-alt"></i> قائمة الطلاب</h2>
            <table class="users-table">
                <thead>
                    <tr>
                        <th>اسم الطالب</th>
                        <th>البريد الإلكتروني</th>
                        <th>تاريخ الانضمام</th>
                        <th>انتهاء الاشتراك</th>
                        <th>الحالة</th>
                        <th>ستريك الدخول</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <!-- سيتم ملئها بواسطة الجافاسكريبت -->
                </tbody>
            </table>
        </div>
        
        <!-- قسم رفع الملفات -->
        <div class="admin-section" id="files-section">
            <h2 class="section-title"><i class="fas fa-cloud-upload-alt"></i> رفع ملفات تعليمية</h2>
            
            <form id="uploadFileForm">
                <div class="form-row">
                    <div class="form-group-half">
                        <label class="form-label">عنوان الملف</label>
                        <input type="text" class="form-input" id="fileTitle" placeholder="عنوان الملف التعليمي" required>
                    </div>
                    <div class="form-group-half">
                        <label class="form-label">نوع الملف</label>
                        <select class="form-input" id="fileType" required>
                            <option value="pdf">PDF</option>
                            <option value="word">Word</option>
                            <option value="video">فيديو</option>
                            <option value="image">صورة</option>
                            <option value="presentation">عرض تقديمي</option>
                            <option value="other">أخرى</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">وصف الملف</label>
                    <textarea class="form-input" id="fileDescription" placeholder="وصف مختصر للملف" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">رفع الملف</label>
                    <div class="input-with-icon">
                        <input type="file" class="form-input" id="fileUpload" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">الطلاب المصرح لهم</label>
                    <div id="usersChecklist">
                        <!-- سيتم ملئها بواسطة الجافاسكريبت -->
                    </div>
                    <button type="button" class="action-btn btn-info" id="selectAllUsers" style="margin-top: 10px;"><i class="fas fa-check-square"></i> تحديد الكل</button>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="action-btn btn-success"><i class="fas fa-upload"></i> رفع الملف</button>
                </div>
            </form>
            
            <h2 class="section-title" style="margin-top: 40px;"><i class="fas fa-file-archive"></i> الملفات المرفوعة</h2>
            <table class="files-table">
                <thead>
                    <tr>
                        <th>عنوان الملف</th>
                        <th>النوع</th>
                        <th>تاريخ الرفع</th>
                        <th>الطلاب المسموح لهم</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody id="filesTableBody">
                    <!-- سيتم ملئها بواسطة الجافاسكريبت -->
                </tbody>
            </table>
        </div>
        
        <!-- قسم إدارة الاختبارات -->
        <div class="admin-section" id="tests-section">
            <h2 class="section-title"><i class="fas fa-edit"></i> إنشاء اختبار جديد</h2>
            
            <form id="addTestForm">
                <div class="form-row">
                    <div class="form-group-half">
                        <label class="form-label">عنوان الاختبار</label>
                        <input type="text" class="form-input" id="testTitle" placeholder="عنوان الاختبار" required>
                    </div>
                    <div class="form-group-half">
                        <label class="form-label">مدة الاختبار (دقائق)</label>
                        <input type="number" class="form-input" id="testDuration" placeholder="مدة الاختبار" min="1" value="60" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">وصف الاختبار</label>
                    <textarea class="form-input" id="testDescription" placeholder="وصف مختصر للاختبار" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">طريقة إضافة الأسئلة</label>
                    <div style="display: flex; gap: 25px; margin-top: 10px;">
                        <div style="display: flex; align-items: center;">
                            <input type="radio" id="uploadImage" name="questionType" value="image" checked style="margin-left: 10px;">
                            <label for="uploadImage" style="font-weight: 600; color: var(--text-dark);">رفع صورة للسؤال</label>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <input type="radio" id="writeQuestion" name="questionType" value="text" style="margin-left: 10px;">
                            <label for="writeQuestion" style="font-weight: 600; color: var(--text-dark);">كتابة السؤال نصياً</label>
                        </div>
                    </div>
                </div>
                
                <div id="questionImageUpload" class="form-group">
                    <label class="form-label">رفع صورة السؤال</label>
                    <div class="input-with-icon">
                        <input type="file" class="form-input" id="questionImage" accept="image/*">
                    </div>
                </div>
                
                <div id="questionTextInput" class="form-group" style="display: none;">
                    <label class="form-label">نص السؤال</label>
                    <textarea class="form-input" id="questionText" placeholder="اكتب نص السؤال هنا" rows="4"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">الاختيارات</label>
                    <div class="form-row">
                        <div class="form-group-half">
                            <input type="text" class="form-input" id="choiceA" placeholder="الاختيار الأول (أ)" required>
                        </div>
                        <div class="form-group-half">
                            <input type="text" class="form-input" id="choiceB" placeholder="الاختيار الثاني (ب)" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group-half">
                            <input type="text" class="form-input" id="choiceC" placeholder="الاختيار الثالث (ج)" required>
                        </div>
                        <div class="form-group-half">
                            <input type="text" class="form-input" id="choiceD" placeholder="الاختيار الرابع (د)" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">الإجابة الصحيحة</label>
                    <select class="form-input" id="correctAnswer" required>
                        <option value="a">الاختيار الأول (أ)</option>
                        <option value="b">الاختيار الثاني (ب)</option>
                        <option value="c">الاختيار الثالث (ج)</option>
                        <option value="d">الاختيار الرابع (د)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">الطلاب المصرح لهم بالاختبار</label>
                    <div id="testUsersChecklist">
                        <!-- سيتم ملئها بواسطة الجافاسكريبت -->
                    </div>
                    <button type="button" class="action-btn btn-info" id="selectAllTestUsers" style="margin-top: 10px;"><i class="fas fa-check-square"></i> تحديد الكل</button>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="action-btn btn-success"><i class="fas fa-plus-circle"></i> إضافة سؤال للاختبار</button>
                    <button type="button" class="action-btn btn-warning" id="finishTestBtn"><i class="fas fa-check-double"></i> إنهاء الاختبار</button>
                </div>
            </form>
            
            <h2 class="section-title" style="margin-top: 40px;"><i class="fas fa-clipboard-list"></i> الاختبارات المنشورة</h2>
            <table class="tests-table">
                <thead>
                    <tr>
                        <th>عنوان الاختبار</th>
                        <th>عدد الأسئلة</th>
                        <th>المدة</th>
                        <th>تاريخ الإنشاء</th>
                        <th>الطلاب المسموح لهم</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody id="testsTableBody">
                    <!-- سيتم ملئها بواسطة الجافاسكريبت -->
                </tbody>
            </table>
        </div>
        
        <!-- قسم إحصائيات متقدمة -->
        <div class="admin-section" id="stats-section">
            <h2 class="section-title"><i class="fas fa-chart-bar"></i> إحصائيات متقدمة للطلاب</h2>
            
            <div class="form-row">
                <div class="form-group-half">
                    <div style="background: white; padding: 30px; border-radius: 20px; text-align: center; border: 1px solid rgba(108, 99, 255, 0.1); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);">
                        <h3 style="color: var(--primary-color); margin-bottom: 15px; font-size: 1.3rem;">أعلى ستريك دخول</h3>
                        <div style="font-size: 3rem; font-weight: 800; color: var(--text-dark); margin-bottom: 10px;" id="topStreak">10</div>
                        <div style="color: var(--text-light); font-weight: 600;" id="topStreakUser">طالب3</div>
                    </div>
                </div>
                <div class="form-group-half">
                    <div style="background: white; padding: 30px; border-radius: 20px; text-align: center; border: 1px solid rgba(108, 99, 255, 0.1); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);">
                        <h3 style="color: var(--accent-color); margin-bottom: 15px; font-size: 1.3rem;">الاشتراكات المنتهية</h3>
                        <div style="font-size: 3rem; font-weight: 800; color: var(--text-dark); margin-bottom: 10px;" id="expiredSubs">0</div>
                        <div style="color: var(--text-light); font-weight: 600;">طالب</div>
                    </div>
                </div>
            </div>
            
            <h2 class="section-title" style="margin-top: 40px;"><i class="fas fa-fire"></i> ترتيب الطلاب حسب ستريك الدخول</h2>
            <table class="users-table">
                <thead>
                    <tr>
                        <th>الترتيب</th>
                        <th>اسم الطالب</th>
                        <th>ستريك الدخول</th>
                        <th>آخر دخول</th>
                        <th>حالة الاشتراك</th>
                        <th>الملفات المتاحة</th>
                    </tr>
                </thead>
                <tbody id="streakTableBody">
                    <!-- سيتم ملئها بواسطة الجافاسكريبت -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // بيانات التطبيق
        let appData = {
            currentUser: null,
            users: [
                {username: "admin", password: "admin", email: "admin@fyo.com", joinDate: "2023-01-01", subscriptionEnd: "2024-12-31", streak: 7, lastLogin: "2023-06-15", isAdmin: true},
                {username: "طالب1", password: "123456", email: "student1@example.com", joinDate: "2023-05-10", subscriptionEnd: "2023-07-10", streak: 5, lastLogin: "2023-06-14", isAdmin: false},
                {username: "طالب2", password: "123456", email: "student2@example.com", joinDate: "2023-05-15", subscriptionEnd: "2023-07-15", streak: 3, lastLogin: "2023-06-13", isAdmin: false},
                {username: "طالب3", password: "123456", email: "student3@example.com", joinDate: "2023-05-20", subscriptionEnd: "2023-07-20", streak: 10, lastLogin: "2023-06-15", isAdmin: false},
                {username: "طالب4", password: "123456", email: "student4@example.com", joinDate: "2023-05-25", subscriptionEnd: "2023-07-25", streak: 2, lastLogin: "2023-06-12", isAdmin: false}
            ],
            files: [
                {id: 1, title: "دليل القدرات الكمي", type: "pdf", description: "دليل شامل للقسم الكمي في اختبار القدرات", uploadDate: "2023-06-01", users: ["طالب1", "طالب2", "طالب3"]},
                {id: 2, title: "فيديو شرح الهندسة", type: "video", description: "شرح مفصل لفقرات الهندسة في القدرات", uploadDate: "2023-06-05", users: ["طالب1", "طالب3"]},
                {id: 3, title: "أسئلة قدرات محلولة", type: "word", description: "مجموعة أسئلة مع الحلول التفصيلية", uploadDate: "2023-06-10", users: ["طالب2", "طالب4"]}
            ],
            tests: [
                {id: 1, title: "اختبار تجريبي 1", description: "اختبار تجريبي شامل لمختلف أقسام القدرات", duration: 60, questions: 20, creationDate: "2023-06-03", users: ["طالب1", "طالب3", "طالب4"]},
                {id: 2, title: "اختبار كمي متقدم", description: "اختبار متقدم للقسم الكمي فقط", duration: 45, questions: 15, creationDate: "2023-06-08", users: ["طالب2", "طالب3"]}
            ],
            currentTestQuestions: []
        };
        
        // حساب الأيام المتبقية للاشتراك
        function calculateRemainingDays(endDate) {
            const today = new Date();
            const end = new Date(endDate);
            const diffTime = end - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }
        
        // تحديث قائمة الطلاب في الجدول
        function updateUsersTable() {
            const tableBody = document.getElementById('usersTableBody');
            tableBody.innerHTML = '';
            
            // تحديث الإحصائيات
            const totalStudents = appData.users.filter(u => !u.isAdmin).length;
            document.getElementById('totalUsers').textContent = totalStudents;
            
            // حساب أعلى ستريك
            let topStreak = 0;
            let topStreakUser = "";
            
            appData.users.forEach((user, index) => {
                if (user.username === 'admin') return; // تخطي المسؤول
                
                const remainingDays = calculateRemainingDays(user.subscriptionEnd);
                let statusBadge = '';
                
                if (remainingDays > 30) {
                    statusBadge = '<span class="badge badge-success">نشط (' + remainingDays + ' يوم)</span>';
                } else if (remainingDays > 0) {
                    statusBadge = '<span class="badge badge-warning">ينتهي قريباً (' + remainingDays + ' يوم)</span>';
                } else {
                    statusBadge = '<span class="badge badge-danger">منتهي</span>';
                }
                
                // تحديث أعلى ستريك
                if (user.streak > topStreak) {
                    topStreak = user.streak;
                    topStreakUser = user.username;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${user.username}</strong></td>
                    <td>${user.email || 'لا يوجد'}</td>
                    <td>${user.joinDate}</td>
                    <td>${user.subscriptionEnd}</td>
                    <td>${statusBadge}</td>
                    <td><span class="badge badge-streak"><i class="fas fa-fire"></i> ${user.streak} يوم</span></td>
                    <td>
                        <button class="action-btn btn-success renew-btn" data-username="${user.username}"><i class="fas fa-sync-alt"></i> تجديد</button>
                        <button class="action-btn btn-danger delete-btn" data-username="${user.username}"><i class="fas fa-trash-alt"></i> حذف</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // تحديث باقي الإحصائيات
            document.getElementById('avgStreak').textContent = (appData.users
                .filter(u => !u.isAdmin)
                .reduce((sum, user) => sum + user.streak, 0) / totalStudents).toFixed(1);
                
            document.getElementById('topStreak').textContent = topStreak;
            document.getElementById('topStreakUser').textContent = topStreakUser;
            
            // حساب الاشتراكات المنتهية
            const expiredSubs = appData.users.filter(u => !u.isAdmin && calculateRemainingDays(u.subscriptionEnd) <= 0).length;
            document.getElementById('expiredSubs').textContent = expiredSubs;
        }
        
        // تحديث قائمة الملفات في الجدول
        function updateFilesTable() {
            const tableBody = document.getElementById('filesTableBody');
            tableBody.innerHTML = '';
            
            appData.files.forEach((file, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${file.title}</strong><br><small style="color: var(--text-light);">${file.description}</small></td>
                    <td><span class="badge badge-info">${file.type}</span></td>
                    <td>${file.uploadDate}</td>
                    <td>${file.users.length} طالب</td>
                    <td>
                        <button class="action-btn edit-file-btn" data-id="${file.id}"><i class="fas fa-edit"></i> تعديل</button>
                        <button class="action-btn btn-danger delete-file-btn" data-id="${file.id}"><i class="fas fa-trash-alt"></i> حذف</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // تحديث الإحصائيات
            document.getElementById('totalFiles').textContent = appData.files.length;
        }
        
        // تحديث قائمة الاختبارات في الجدول
        function updateTestsTable() {
            const tableBody = document.getElementById('testsTableBody');
            tableBody.innerHTML = '';
            
            appData.tests.forEach((test, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${test.title}</strong><br><small style="color: var(--text-light);">${test.description}</small></td>
                    <td>${test.questions} سؤال</td>
                    <td>${test.duration} دقيقة</td>
                    <td>${test.creationDate}</td>
                    <td>${test.users.length} طالب</td>
                    <td>
                        <button class="action-btn edit-test-btn" data-id="${test.id}"><i class="fas fa-edit"></i> تعديل</button>
                        <button class="action-btn btn-danger delete-test-btn" data-id="${test.id}"><i class="fas fa-trash-alt"></i> حذف</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // تحديث الإحصائيات
            document.getElementById('totalTests').textContent = appData.tests.length;
        }
        
        // تحديث قائمة ستريك الدخول
        function updateStreakTable() {
            const tableBody = document.getElementById('streakTableBody');
            tableBody.innerHTML = '';
            
            // فرز الطلاب حسب الستريك
            const sortedUsers = [...appData.users]
                .filter(u => !u.isAdmin)
                .sort((a, b) => b.streak - a.streak);
            
            sortedUsers.forEach((user, index) => {
                const remainingDays = calculateRemainingDays(user.subscriptionEnd);
                const status = remainingDays > 0 ? 'نشط' : 'منتهي';
                const statusClass = status === 'نشط' ? 'badge-success' : 'badge-danger';
                
                // حساب عدد الملفات المتاحة للطالب
                const availableFiles = appData.files.filter(f => f.users.includes(user.username)).length;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="badge badge-info">${index + 1}</span></td>
                    <td><strong>${user.username}</strong></td>
                    <td><span class="badge badge-streak"><i class="fas fa-fire"></i> ${user.streak} يوم</span></td>
                    <td>${user.lastLogin}</td>
                    <td><span class="badge ${statusClass}">${status} (${remainingDays} يوم)</span></td>
                    <td><span class="badge badge-info">${availableFiles} ملف</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // تحديث قوائم الاختيار للطلاب
        function updateUsersChecklists() {
            const usersChecklist = document.getElementById('usersChecklist');
            const testUsersChecklist = document.getElementById('testUsersChecklist');
            
            usersChecklist.innerHTML = '';
            testUsersChecklist.innerHTML = '';
            
            appData.users.forEach(user => {
                if (user.username === 'admin') return;
                
                const remainingDays = calculateRemainingDays(user.subscriptionEnd);
                const isActive = remainingDays > 0;
                
                const checkbox1 = document.createElement('div');
                checkbox1.style.marginBottom = '10px';
                checkbox1.style.display = 'flex';
                checkbox1.style.alignItems = 'center';
                checkbox1.innerHTML = `
                    <input type="checkbox" id="user-${user.username}-files" name="users" value="${user.username}" ${isActive ? 'checked' : ''} ${!isActive ? 'disabled' : ''}>
                    <label for="user-${user.username}-files" style="margin-right: 10px; font-weight: 500; ${!isActive ? 'color: var(--text-light);' : ''}">${user.username} ${!isActive ? '(اشتراك منتهي)' : ''}</label>
                `;
                usersChecklist.appendChild(checkbox1);
                
                const checkbox2 = document.createElement('div');
                checkbox2.style.marginBottom = '10px';
                checkbox2.style.display = 'flex';
                checkbox2.style.alignItems = 'center';
                checkbox2.innerHTML = `
                    <input type="checkbox" id="user-${user.username}-tests" name="testUsers" value="${user.username}" ${isActive ? 'checked' : ''} ${!isActive ? 'disabled' : ''}>
                    <label for="user-${user.username}-tests" style="margin-right: 10px; font-weight: 500; ${!isActive ? 'color: var(--text-light);' : ''}">${user.username} ${!isActive ? '(اشتراك منتهي)' : ''}</label>
                `;
                testUsersChecklist.appendChild(checkbox2);
            });
        }
        
        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            // تحديث الجداول
            updateUsersTable();
            updateFilesTable();
            updateTestsTable();
            updateStreakTable();
            updateUsersChecklists();
            
            // تسجيل الدخول
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // التحقق من بيانات الدخول
                const user = appData.users.find(u => u.username === username && u.password === password);
                
                if (user && user.isAdmin) {
                    appData.currentUser = user;
                    
                    // تحديث آخر دخول
                    const today = new Date().toISOString().split('T')[0];
                    user.lastLogin = today;
                    
                    // عرض لوحة المسؤول
                    document.getElementById('loginContainer').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    
                    // تحديث كل الجداول
                    updateUsersTable();
                    updateFilesTable();
                    updateTestsTable();
                    updateStreakTable();
                    updateUsersChecklists();
                    
                    // إظهار رسالة ترحيب
                    alert(`مرحباً ${user.username}! تم تسجيل الدخول بنجاح إلى لوحة التحكم.`);
                } else {
                    alert('بيانات الدخول غير صحيحة أو ليس لديك صلاحية الدخول! هذه الواجهة للمسؤول فقط.');
                }
            });
            
            // تسجيل الخروج
            document.getElementById('logoutBtn').addEventListener('click', function() {
                appData.currentUser = null;
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('loginContainer').style.display = 'block';
                document.getElementById('loginForm').reset();
            });
            
            // التنقل بين الأقسام
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // إزالة النشاط من جميع الأزرار
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    // إضافة النشاط للزر الحالي
                    this.classList.add('active');
                    
                    // إخفاء جميع الأقسام
                    document.querySelectorAll('.admin-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // إظهار القسم المحدد
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                });
            });
            
            // إضافة طالب جديد
            document.getElementById('addUserForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newUsername = document.getElementById('newUsername').value;
                const newPassword = document.getElementById('newPassword').value;
                const newEmail = document.getElementById('newEmail').value;
                const subscriptionDays = parseInt(document.getElementById('subscriptionDays').value);
                
                // التحقق من عدم تكرار اسم المستخدم
                if (appData.users.find(u => u.username === newUsername)) {
                    alert('اسم الطالب موجود مسبقاً!');
                    return;
                }
                
                // حساب تاريخ انتهاء الاشتراك
                const today = new Date();
                const endDate = new Date(today);
                endDate.setDate(today.getDate() + subscriptionDays);
                const endDateStr = endDate.toISOString().split('T')[0];
                const joinDateStr = today.toISOString().split('T')[0];
                
                // إضافة الطالب الجديد
                appData.users.push({
                    username: newUsername,
                    password: newPassword,
                    email: newEmail,
                    joinDate: joinDateStr,
                    subscriptionEnd: endDateStr,
                    streak: 0,
                    lastLogin: joinDateStr,
                    isAdmin: false
                });
                
                // تحديث الجداول
                updateUsersTable();
                updateUsersChecklists();
                updateStreakTable();
                
                // إعادة تعيين النموذج
                document.getElementById('addUserForm').reset();
                document.getElementById('subscriptionDays').value = 30;
                
                alert(`تم إضافة الطالب ${newUsername} بنجاح!`);
            });
            
            // تجديد جميع الاشتراكات
            document.getElementById('renewAllBtn').addEventListener('click', function() {
                const daysToAdd = parseInt(prompt('كم يوم تريد إضافته لاشتراكات جميع الطلاب؟', '30'));
                
                if (daysToAdd && daysToAdd > 0) {
                    appData.users.forEach(user => {
                        if (!user.isAdmin) {
                            const currentEndDate = new Date(user.subscriptionEnd);
                            currentEndDate.setDate(currentEndDate.getDate() + daysToAdd);
                            user.subscriptionEnd = currentEndDate.toISOString().split('T')[0];
                        }
                    });
                    
                    updateUsersTable();
                    updateStreakTable();
                    updateUsersChecklists();
                    alert(`تم تجديد اشتراكات جميع الطلاب بمقدار ${daysToAdd} يوم!`);
                }
            });
            
            // تفويض حذف وتجديد الطلاب
            document.addEventListener('click', function(e) {
                // تجديد اشتراك طالب
                if (e.target.classList.contains('renew-btn') || e.target.parentElement.classList.contains('renew-btn')) {
                    const btn = e.target.classList.contains('renew-btn') ? e.target : e.target.parentElement;
                    const username = btn.getAttribute('data-username');
                    const daysToAdd = parseInt(prompt(`كم يوم تريد إضافته لاشتراك ${username}؟`, '30'));
                    
                    if (daysToAdd && daysToAdd > 0) {
                        const user = appData.users.find(u => u.username === username);
                        const currentEndDate = new Date(user.subscriptionEnd);
                        currentEndDate.setDate(currentEndDate.getDate() + daysToAdd);
                        user.subscriptionEnd = currentEndDate.toISOString().split('T')[0];
                        
                        updateUsersTable();
                        updateStreakTable();
                        updateUsersChecklists();
                        alert(`تم تجديد اشتراك ${username} بمقدار ${daysToAdd} يوم!`);
                    }
                }
                
                // حذف طالب
                if (e.target.classList.contains('delete-btn') || e.target.parentElement.classList.contains('delete-btn')) {
                    const btn = e.target.classList.contains('delete-btn') ? e.target : e.target.parentElement;
                    const username = btn.getAttribute('data-username');
                    
                    if (confirm(`هل أنت متأكد من حذف الطالب ${username}؟`)) {
                        appData.users = appData.users.filter(u => u.username !== username);
                        
                        // تحديث الجداول
                        updateUsersTable();
                        updateUsersChecklists();
                        updateStreakTable();
                        
                        alert(`تم حذف الطالب ${username} بنجاح!`);
                    }
                }
                
                // حذف ملف
                if (e.target.classList.contains('delete-file-btn') || e.target.parentElement.classList.contains('delete-file-btn')) {
                    const btn = e.target.classList.contains('delete-file-btn') ? e.target : e.target.parentElement;
                    const fileId = parseInt(btn.getAttribute('data-id'));
                    
                    if (confirm('هل أنت متأكد من حذف هذا الملف؟')) {
                        appData.files = appData.files.filter(f => f.id !== fileId);
                        updateFilesTable();
                        alert('تم حذف الملف بنجاح!');
                    }
                }
                
                // حذف اختبار
                if (e.target.classList.contains('delete-test-btn') || e.target.parentElement.classList.contains('delete-test-btn')) {
                    const btn = e.target.classList.contains('delete-test-btn') ? e.target : e.target.parentElement;
                    const testId = parseInt(btn.getAttribute('data-id'));
                    
                    if (confirm('هل أنت متأكد من حذف هذا الاختبار؟')) {
                        appData.tests = appData.tests.filter(t => t.id !== testId);
                        updateTestsTable();
                        alert('تم حذف الاختبار بنجاح!');
                    }
                }
            });
            
            // رفع ملف
            document.getElementById('uploadFileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const fileTitle = document.getElementById('fileTitle').value;
                const fileType = document.getElementById('fileType').value;
                const fileDescription = document.getElementById('fileDescription').value;
                const fileUpload = document.getElementById('fileUpload').files[0];
                
                // الحصول على الطلاب المحددين
                const selectedUsers = [];
                document.querySelectorAll('#usersChecklist input[name="users"]:checked').forEach(checkbox => {
                    if (!checkbox.disabled) {
                        selectedUsers.push(checkbox.value);
                    }
                });
                
                if (selectedUsers.length === 0) {
                    alert('يرجى تحديد طالب واحد على الأقل لديه اشتراك نشط!');
                    return;
                }
                
                // إنشاء معرف فريد للملف
                const newId = appData.files.length > 0 ? Math.max(...appData.files.map(f => f.id)) + 1 : 1;
                const today = new Date().toISOString().split('T')[0];
                
                // إضافة الملف الجديد
                appData.files.push({
                    id: newId,
                    title: fileTitle,
                    type: fileType,
                    description: fileDescription,
                    uploadDate: today,
                    users: selectedUsers
                });
                
                // تحديث الجدول
                updateFilesTable();
                
                // إعادة تعيين النموذج
                document.getElementById('uploadFileForm').reset();
                document.getElementById('fileType').value = 'pdf';
                
                // إعادة تحديد جميع الطلاب النشطين
                document.querySelectorAll('#usersChecklist input[name="users"]').forEach(checkbox => {
                    checkbox.checked = !checkbox.disabled;
                });
                
                alert(`تم رفع الملف "${fileTitle}" بنجاح!`);
            });
            
            // تحديد جميع الطلاب للملفات
            document.getElementById('selectAllUsers').addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('#usersChecklist input[name="users"]:not(:disabled)');
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                
                checkboxes.forEach(cb => {
                    cb.checked = !allChecked;
                });
                
                this.innerHTML = allChecked ? 
                    '<i class="fas fa-check-square"></i> تحديد الكل' : 
                    '<i class="fas fa-times"></i> إلغاء التحديد';
            });
            
            // تحديد جميع الطلاب للاختبارات
            document.getElementById('selectAllTestUsers').addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('#testUsersChecklist input[name="testUsers"]:not(:disabled)');
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                
                checkboxes.forEach(cb => {
                    cb.checked = !allChecked;
                });
                
                this.innerHTML = allChecked ? 
                    '<i class="fas fa-check-square"></i> تحديد الكل' : 
                    '<i class="fas fa-times"></i> إلغاء التحديد';
            });
            
            // تغيير طريقة إضافة السؤال
            document.querySelectorAll('input[name="questionType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'image') {
                        document.getElementById('questionImageUpload').style.display = 'block';
                        document.getElementById('questionTextInput').style.display = 'none';
                    } else {
                        document.getElementById('questionImageUpload').style.display = 'none';
                        document.getElementById('questionTextInput').style.display = 'block';
                    }
                });
            });
            
            // إضافة سؤال للاختبار الحالي
            document.getElementById('addTestForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const questionType = document.querySelector('input[name="questionType"]:checked').value;
                const choiceA = document.getElementById('choiceA').value;
                const choiceB = document.getElementById('choiceB').value;
                const choiceC = document.getElementById('choiceC').value;
                const choiceD = document.getElementById('choiceD').value;
                const correctAnswer = document.getElementById('correctAnswer').value;
                
                let questionContent = '';
                if (questionType === 'image') {
                    const file = document.getElementById('questionImage').files[0];
                    if (!file) {
                        alert('يرجى رفع صورة للسؤال!');
                        return;
                    }
                    questionContent = `صورة: ${file.name}`;
                } else {
                    questionContent = document.getElementById('questionText').value;
                    if (!questionContent.trim()) {
                        alert('يرجى كتابة نص السؤال!');
                        return;
                    }
                }
                
                // إضافة السؤال للاختبار الحالي
                appData.currentTestQuestions.push({
                    id: appData.currentTestQuestions.length + 1,
                    type: questionType,
                    content: questionContent,
                    choices: {a: choiceA, b: choiceB, c: choiceC, d: choiceD},
                    correctAnswer: correctAnswer
                });
                
                // إعادة تعيين حقول السؤال
                document.getElementById('choiceA').value = '';
                document.getElementById('choiceB').value = '';
                document.getElementById('choiceC').value = '';
                document.getElementById('choiceD').value = '';
                document.getElementById('questionText').value = '';
                document.getElementById('questionImage').value = '';
                document.getElementById('correctAnswer').value = 'a';
                
                alert(`تم إضافة السؤال رقم ${appData.currentTestQuestions.length} للاختبار الحالي!`);
            });
            
            // إنهاء الاختبار وإنشاؤه
            document.getElementById('finishTestBtn').addEventListener('click', function() {
                if (appData.currentTestQuestions.length === 0) {
                    alert('يرجى إضافة أسئلة أولاً قبل إنهاء الاختبار!');
                    return;
                }
                
                const testTitle = document.getElementById('testTitle').value;
                const testDuration = parseInt(document.getElementById('testDuration').value);
                const testDescription = document.getElementById('testDescription').value;
                
                if (!testTitle.trim()) {
                    alert('يرجى إدخال عنوان للاختبار!');
                    return;
                }
                
                // الحصول على الطلاب المحددين
                const selectedUsers = [];
                document.querySelectorAll('#testUsersChecklist input[name="testUsers"]:checked').forEach(checkbox => {
                    if (!checkbox.disabled) {
                        selectedUsers.push(checkbox.value);
                    }
                });
                
                if (selectedUsers.length === 0) {
                    alert('يرجى تحديد طالب واحد على الأقل لديه اشتراك نشط!');
                    return;
                }
                
                // إنشاء معرف فريد للاختبار
                const newId = appData.tests.length > 0 ? Math.max(...appData.tests.map(t => t.id)) + 1 : 1;
                const today = new Date().toISOString().split('T')[0];
                
                // إضافة الاختبار الجديد
                appData.tests.push({
                    id: newId,
                    title: testTitle,
                    description: testDescription,
                    duration: testDuration,
                    questions: appData.currentTestQuestions.length,
                    creationDate: today,
                    users: selectedUsers
                });
                
                // تحديث الجدول
                updateTestsTable();
                
                // إعادة تعيين النموذج ومسح الأسئلة الحالية
                appData.currentTestQuestions = [];
                document.getElementById('addTestForm').reset();
                document.getElementById('testDuration').value = 60;
                document.getElementById('correctAnswer').value = 'a';
                
                // إعادة تحديد جميع الطلاب النشطين
                document.querySelectorAll('#testUsersChecklist input[name="testUsers"]').forEach(checkbox => {
                    checkbox.checked = !checkbox.disabled;
                });
                
                alert(`تم إنشاء الاختبار "${testTitle}" بنجاح بعدد ${appData.tests[appData.tests.length-1].questions} سؤال!`);
            });
        });
    </script>
</body>
</html>
